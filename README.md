# 实时图像分类器

这是一个使用TFLite模型进行实时屏幕捕获和图像分类的Windows应用程序，支持多模型切换和自动模型发现。

## 功能特性

- 🖥️ 实时屏幕捕获（全屏或自定义区域）
- 🤖 使用预训练的TFLite模型进行图像分类
- 📊 实时显示分类结果和置信度
- 🔄 **多模型切换**：支持在运行时切换不同的分类模型
- 🔍 **自动模型发现**：自动扫描模型目录并加载可用模型
- 🏷️ **智能标签管理**：根据模型自动配置分类标签

## 安装要求

### 系统要求
- Windows 10/11
- Python 3.7+
- 至少4GB RAM

### Python依赖
```bash
# 安装所需依赖
pip install -r requirements.txt
```

## 快速开始

### 1. 检查您的模型
```bash
# 检查单个模型
python check_model.py

# 检查所有模型（推荐）
python check_model.py --all

# 检查指定模型
python check_model.py model/model.tflite
```

### 2. 启动应用程序
```bash
# 使用启动脚本（推荐）
start.bat

# 直接运行
python main.py
```

### 3. 使用界面
- 选择要使用的模型
- 点击"开始捕获"按钮开始实时分类
- 选择捕获区域（全屏或自定义区域）
- 查看实时分类结果
- 点击"停止捕获"按钮停止

## 模型管理

### 支持的模型类型

#### 1. 花朵分类模型 (`model.tflite`)
- **类别**: 5种花朵
- **标签**: daisy, dandelion, roses, sunflowers, tulips
- **用途**: 识别不同类型的花朵

#### 2. 动物分类模型 (`model1.tflite`)
- **类别**: 5种动物
- **标签**: cats, chicken, cow, dogs, elephant
- **用途**: 识别不同类型的动物

#### 3. 自定义模型
- 支持任意类别数量的分类模型
- 自动生成通用标签（类别0, 类别1, 类别2...）
- 自动检测输入输出格式

### 模型切换功能

#### 界面操作
1. **选择模型**: 从下拉框选择要使用的模型
2. **切换模型**: 点击"切换模型"按钮
3. **刷新模型**: 点击"刷新模型"按钮重新扫描目录
4. **模型信息**: 显示当前使用的模型名称

#### 自动模型发现
- 程序启动时自动扫描 `model/` 目录
- 查找所有 `.tflite` 文件
- 自动配置模型信息和标签
- 支持热插拔（添加新模型后点击刷新）

### 模型检查工具

#### 功能特性
- **自动检测**: 自动发现模型目录中的所有模型
- **兼容性检查**: 验证模型与代码的兼容性
- **标签建议**: 根据类别数量提供标签建议
- **详细报告**: 生成完整的检查报告

#### 使用方法
```bash
# 检查所有模型
python check_model.py --all

# 检查单个模型
python check_model.py model/model.tflite

# 检查默认模型
python check_model.py
```

#### 检查内容
- 模型文件完整性
- 输入输出格式
- 类别数量检测
- 数据类型验证
- 量化信息检查
- 兼容性分析

## 使用方法

### 基本操作
1. **启动应用程序**
   ```bash
   start.bat
   ```

2. **选择模型**
   - 从下拉框选择要使用的模型
   - 查看模型信息
   - 点击"切换模型"应用选择

3. **开始分类**
   - 点击"开始捕获"按钮
   - 选择捕获区域（全屏或自定义区域）
   - 查看实时分类结果
   - 点击"停止捕获"按钮停止

### 高级功能

#### 自定义捕获区域
- **全屏模式**: 捕获整个屏幕
- **自定义区域**: 精确设置X、Y坐标和宽高
- **实时预览**: 显示当前捕获区域
- **参数调整**: 支持0-1920的X坐标，0-1080的Y坐标

#### 模型管理
- **模型切换**: 运行时切换不同模型
- **自动发现**: 新模型自动识别
- **标签管理**: 自动配置分类标签
- **兼容性检查**: 验证模型可用性

## 项目结构

```
image_classifier/
├── main.py                 # 主应用程序
├── check_model.py          # 模型检查工具
├── start.bat              # 启动脚本
├── requirements.txt        # Python依赖
├── README.md              # 说明文档
└── model/                 # 模型目录
    ├── model.tflite       # 花朵分类模型
    └── model1.tflite      # 动物分类模型
```

## 配置说明

### 模型配置
程序会自动检测模型目录中的模型文件，您也可以手动配置：

```python
# 在 main.py 中配置模型
self.models = {
    'flowers': {
        'path': 'model/model.tflite',
        'labels': ['daisy', 'dandelion', 'roses', 'sunflowers', 'tulips'],
        'name': '花朵分类模型'
    },
    'animals': {
        'path': 'model/model1.tflite', 
        'labels': ['cats', 'chicken', 'cow', 'dogs', 'elephant'],
        'name': '动物分类模型'
    }
}
```

### 标签配置
每个模型都有对应的标签配置：

```python
# 花朵模型标签
['daisy', 'dandelion', 'roses', 'sunflowers', 'tulips']

# 动物模型标签
['cats', 'chicken', 'cow', 'dogs', 'elephant']

# 通用标签（自动生成）
['类别0', '类别1', '类别2', '类别3', '类别4']
```

## 故障排除

### 常见问题

1. **模型加载失败**
   - 使用 `python check_model.py --all` 检查所有模型
   - 确保模型文件在正确的目录中
   - 验证模型文件格式

2. **模型切换失败**
   - 检查模型文件是否存在
   - 验证模型格式是否兼容
   - 查看控制台错误信息

3. **标签不匹配**
   - 使用模型检查工具验证类别数量
   - 确保标签列表与模型输出匹配
   - 检查预定义标签映射

4. **性能问题**
   - 使用更小的模型
   - 降低捕获帧率
   - 使用自定义区域而非全屏

### 调试工具

#### 模型检查工具
```bash
# 全面检查
python check_model.py --all

# 详细输出
python check_model.py model/model.tflite
```

#### 控制台输出
- 程序启动时会显示发现的模型
- 模型切换时会显示详细信息
- 错误信息会显示在控制台

## 扩展功能

### 添加新模型
1. 将 `.tflite` 文件放入 `model/` 目录
2. 点击"刷新模型"按钮
3. 从下拉框选择新模型
4. 点击"切换模型"应用

### 自定义标签
对于没有预定义标签的模型，程序会自动生成通用标签。您也可以手动配置：

```python
# 在 generate_labels_for_model 方法中添加
label_mappings = {
    'your_model': ['标签1', '标签2', '标签3', '标签4', '标签5'],
    # ... 其他模型
}
```

### 模型优化
- 使用量化模型提高性能
- 选择合适输入尺寸的模型
- 考虑使用GPU加速（如果可用）

## 许可证

本项目仅供学习和研究使用。

## 技术支持

如遇到问题，请按以下顺序检查：
1. 使用 `python check_model.py --all` 检查模型
2. 查看控制台错误信息
3. 验证模型文件完整性
4. 检查Python环境和依赖包
5. 确认系统权限设置
